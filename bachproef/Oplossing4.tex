%%=============================================================================
%% Replication Manager (repmgr)
%%=============================================================================

\chapter{Replication Manager (repmgr)}
\label{ch:Replication Manager (repmgr)}

In dit hoofdstuk wordt meer informatie verleend over Replication Manager (repmgr) als een PostgreSQL High Availability cluster oplossing. Er zal worden ingegaan op de verschillende requirements, waaraan voldaan moet worden. Hierbij wordt dan telkens ook een score gegeven die in Hoofdstuk~\ref{ch:Verwerking resultaten} verder geanalyseerd zal worden.

\section{\IfLanguageName{dutch}{Inleiding tot Replication Manager (repmgr)}{Inleiding tot Replication Manager (repmgr)}}
\label{sec:Inleiding tot Replication Manager (repmgr)}

Replication Manager (repmgr) is een open source oplossing ontwikkeld door 2ndQuadrant. Het is ontwikkeld voor het beheer van replicatie en failover in een PostgreSQL cluster.

Replication Manager (repmgr) biedt de tools om PostgreSQL replicatie op te zetten, te configureren, te beheren en te monitoren. Het stelt de gebruiker in staat om handmatige omschakeling en failover taken uit te voeren met behulp van repmgr utility. Dit is een open source tool die PostgreSQL's ingebouwde streaming replicatie ondersteunt en verbetert.

\section{\IfLanguageName{dutch}{Requirements}{Requirements}}
\label{sec:Requirements}

\subsection{\IfLanguageName{dutch}{Must have}{Must have}}
\label{subsec:Must have}

%Voorbeelden van tools zijn repmgr en repmgrd.
%Replication Manager (RepMgr) biedt ook de tools om primary en standby nodes op te zetten, en om in geval van faalscenario automatische failover te doen.

%De functionaliteiten van Replication Manager (RepMgr) sluiten voldoende aan op de vooropgestelde “Must haves” en krijgt hiervoor 12/15 punten.

\subsubsection{\IfLanguageName{dutch}{Ondersteuning van replicatie}{Ondersteuning van replicatie}}
\label{subsubsec:Ondersteuning van replicatie}

%Replication Manager (RepMgr) is een oplossing ontwikkeld voor het beheren van replicatie en failover van PostgreSQL clusters. Het biedt de tools aan om replicatie van PostgreSQL op te zetten, te configureren, te beheren en te monitoren. Het laat ook toe om handmatige omschakeling en failover taken uit te voeren met behulp van repmgr utility. Dit is een gratis tool die ondersteuning en verbetering biedt van PostgreSQL's ingebouwde streaming replicatie.
Replication Manager (RepMgr) maakt standaard gebruik van streaming replicatie in zijn clusters.

Deze streaming replicatie moet vaak manueel geconfigureerd worden in zowel de primary als de standby node. Het zal ook gebruik maken van pg\_basebackup zodat alle standby nodes kunnen invallen wanneer de primary node uitvalt.

Met repmgr is het mogelijk om deze taken geautomatiseerd uit te voeren, wat veel tijd en resources kan sparen.

Voor replicatie krijgt Replication Manager (repmgr) een score van 4.

\subsubsection{\IfLanguageName{dutch}{Ondersteuning van failover}{Ondersteuning van failover}}
\label{subsubsec:Ondersteuning van failover}

%https://www.2ndquadrant.com/en/blog/how-to-automate-postgresql-12-replication-and-failover-with-repmgr-part-2/

Aan de hand van de tool repmgrd zal er automatische failover in gang worden gezet wanneer de primary node op down komt te staan. Hier wordt er dan een nieuwe standby node gekozen invalt voor de voormalige primary node.  

Het zal in geval van failover of andere situaties ook de nodige notificaties uitsturen om te laten weten wat er aan de hand is. Deze situaties worden dan door de gebruiker zelf geregistreerd.

Om repmgrd te laten werken zal in het repmgr.conf bestand, bij failover 'automatic' worden ingegeven. Hierna zal de repmgrd daemon de cluster actief beginnen te monitoren. Als er een fout optreedt in de primary node, zal het meerdere keren proberen opnieuw verbinding te maken. Als alle pogingen om verbinding te maken met de primary node mislukken, wordt de meest geschikte standby gekozen als de nieuwe primary node door repmgrd.

Door de hierboven genoemde redenen, krijgt Replication Manager (repmgr) een score van 4 voor failover.

\subsubsection{\IfLanguageName{dutch}{Ondersteuning van monitoring}{Ondersteuning van monitoring}}
\label{subsubsec:Ondersteuning van monitoring}

Over Monitoring is er bij Replication Manager (repmgr) niet veel te vinden. De tools repmgrd zal wel actief de cluster monitoren, en op basis hiervan de nodige acties uitvoeren, naargelang de staat van de cluster.

Voor monitoring krijgt Replication Manager (repmgr) een score van 3.

\subsection{\IfLanguageName{dutch}{Should have}{Should have}}
\label{subsec:Should have}

%Replication Manager (RepMgr) is open source, ontwikkeld door 2ndQuadrant.
%De laatste release was op 22 oktober 2020.

%Replication Manager (RepMgr) krijgt hierdoor een score van 4/5 voor “Should have”. Doordat er (nog) geen release is in 2021, krijgt het geen 5/5.

\subsubsection{\IfLanguageName{dutch}{Actieve ondersteuning in 2020-2021}{Actieve ondersteuning in 2020-2021}}
\label{subsubsec:Actieve ondersteuning in 2020-2021}

\subsubsection{\IfLanguageName{dutch}{Open source}{Open source}}
\label{subsubsec:Open source}

Replication Manager (repmgr) is een open source High Availability tool voor PostgreSQL clustering.

\subsection{\IfLanguageName{dutch}{Could have}{Could have}}
\label{subsec:Could have}

\subsubsection{\IfLanguageName{dutch}{Grafische interface}{Grafische interface}}
\label{subsubsec:Grafische interface}

Op eerste zicht lijkt er niet direct een bekende grafische interface aanwezig te zijn voor Replication Manager (repmgr).

\subsubsection{\IfLanguageName{dutch}{Beperkte manuele interventie}{Beperkte manuele interventie}}
\label{subsubsec:Beperkte manuele interventie}

Bij Replication Manager (repmgr) is er nog veel dat manueel moet uitegevoerd worden.


Dit was de laatste requirement waarop Replication Manager (repmgr) geëvalueerd zou worden. In onderstaande tabel~\ref{table:Overzicht score Replication Manager (repmgr)} is het overzicht terug te vinden van de scores per requirement. Dit zal enkel gaan over de requirements \colorbox{teal}{“must have”} en \colorbox{cyan}{“should have”}. De “could have” requirements hebben geen invloed op de eindscore.

\begin{table}[!h]
    \centering
    \begin{tabular}{ |p{6cm}||p{6cm}|  }
        \hline
        \multicolumn{2}{|c|}{Overzicht score Replication Manager (repmgr)} \\
        \hline
        \colorbox{teal}{“Must have”} & \\
        \hline
        Ondersteuning van replicatie  & 4 \\
        Ondersteuning van failover &  4 \\
        Ondersteuning van monitoring & 3 \\
        \hline
        \colorbox{cyan}{“Should have”} & \\
        \hline
        Open Source &  5 \\
        Ondersteuning in 2020-2021 & 4 \\
        \hline
        \hline
        Totaal & 20/25 \\
        \hline
    \end{tabular}
    \caption{Overzicht score Replication Manager (repmgr)}
    \label{table:Overzicht score Replication Manager (repmgr)}
\end{table}